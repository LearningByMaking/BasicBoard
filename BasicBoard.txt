;ulogo file for BasicBoard
 
constants [[rpacket $1fc0]] ;this constant defined the memory address where packets are written on the MSP430

 to ul-power
	 init-leds ;this initializes the LED pins
	 redon 
	 wait 10 
	 redoff 
 end
 
 
 
 to ul-init
	 yellowon 
         dp3output ;prepare pin for external LED
         dp2output ;prepare pin for external LED
	 wait 10
	 yellowoff
 end

 
 
 to ul-go
 	 greenon
	 wait 10
	 greenoff

	 loop ;this part of the code is executed forever
	 [
		greenon	 	
		collect-data
		wait 10 
		greenoff
	 	wait 100
	 ]
 
 end

 to collect-data
 	init-packet 42 ;create a new packet with an (abritary) packet number of 43
 	fprint readADC 6 ;read the light sensor value from ADC 6
 	fprint readADC 5 ;read the temp sensor value from ADC 5
 	fprint readADC 4 ;read the temp sensor value from ADC 4
 	add-checksum 
 end

 to yellowon
	 redon
	 greenon
 end

 to yellowoff
	 redoff
	 greenoff
 end

to calibrateADC :n 
   let [total 0] ;creates a variable for a running total
   let [sample 10] ;set the number of samples to average
   repeat :sample	
   [
     let [adc (readADC :n)] ;get the value from the ADC
     let [total :total + :adc] ;add that ADC value to the total
     print :adc      ;print the ADC value
     wait 10
   ]
   let [total :total / :sample] ;find the average (mean) value
   prs "Average:
   print :total ;print the average

end

to led1on
   dp3on ;turns on the io pin for LED 1
end

to led1off
  dp3off ;turns off the io pin for LED 1
end

to led2on
   dp2on ;turns on the io pin for LED 2
end

to led2off 
   dp2off ;turns off the io pin for LED 2
end


